// Module included in the following assemblies:
//
// * networking/bgp-routing/about-bgp-routing.adoc

:_mod-docs-content-type: CONCEPT
[id="nw-bgp-about_{context}"]
= Advanced routing with BGP

Integrating BGP into OVN-Kubernetes provides several capabilities to enhance network functionality:

- Importing Routes from the Provider Network: Currently, users must manually configure routes on each node using local gateway mode and tools like NM State, which is cumbersome and not dynamic. BGP integration allows OVN-Kubernetes to import routes directly from the provider network, eliminating manual configurations and enabling dynamic routing updates in response to network changes.

- Exporting Routes into the Provider Network: While MetalLB advertises load balancer IPs via BGP, there's a need to advertise pod IPs directly to the provider network for better integration with third-party load balancers. BGP integration enables OVN-Kubernetes to export pod subnets or addresses, allowing external devices to reach pods directly without relying on custom operators to manage routing.

- Datapath Performance Enhancement: By leveraging the underlay network through BGP, tunnel encapsulation can be bypassed, reducing packet overhead and increasing throughput. This direct use of the underlay network enhances performance for applications requiring high bandwidth.

- Multi-homing, Link Redundancy, and Fast Convergence: BGP supports multi-homing with Equal-Cost Multi-Path (ECMP) routing, providing layer 3 failover capabilities. Coupled with Bidirectional Forwarding Detection (BFD), BGP can detect link failures within milliseconds, allowing rapid rerouting of traffic. This is crucial in topologies where nodes have multiple NICs connected to different BGP routers, ensuring high availability and network resilience.

[id="prerequisites_{context}"]
== Prerequisites

Use of advanced routing features requires that you have properly configured BGP for your network infrastructure. Outages or misconfigurations of your network infrastructure might cause disruptions to your cluster network.

[id="cluster-network-operator_{context}"]
== Cluster Network Operator configuration

The Cluster Network Operator API exposes several fields to configure advanced routing:

- `spec.additionalRoutingCapabilities`: Enables deployment of the FRR-K8S daemon for the cluster, which can be used independently of route advertisements, such as for the MetalLB Operator. When enabled, the FRR-K8S daemon is deployed on all nodes.
- `spec.defaultNetwork.ovnKubernetesConfig.routeAdvertisements`: Enables route advertisements for the default cluster network and user-defined networks. Additional routing capabilities must be enabled to enable route advertisements.

[id="compatibility-with-other-networking-features_{context}"]
== Compatibility with other networking features

Multiple external gateways::
--
When used with multiple external gateways (MEG) as implemented with the `AdminPolicyBasedExternalRoute` CR, there are several potential interactions:

- When BGP discovers routes to next hops, there can overlap with gateways detected by MEG. If BFD is configured with `nextHops.static.bfdEnabled`, overlapping routes are ignored by OVN-Kubernetes. If BFD is configured in FRR, overlapping routes are immediately purged.
- When MEG is configured for a namespace targeted by a `RouteAdvertisements` CR network selector, an external gateway capable of BGP peering may learn of the pod subnet routes automatically.
--

EgressIPs::
Works with EgressIPs. Moreover these IP addresses are advertised with BGP, so egress IP nodes no longer need to be on the same layer 2 network segment.

Services::
Works in concert with the MetalLB Operator to advertise services to the provider network.

Egress service::
Full support.

Egress firewall::
Full support.

Egress QoS::
Full support.

Network policies::
Full support.

Direct pod ingress::
Full support for the default cluster network and user-defined networks.

[id="considerations-for-use-with-the-metallb-operator_{context}"]
== Considerations for use with the MetalLB Operator

The MetalLB Operator is installed as an add-on to the cluster. Because both BGP routing and MetalLB rely on FRR-K8s for BGP support, enabling additional routing capabilities automatically installs FRR-K8s. When installed, the MetalLB Operator uses the FRR-K8s daemon installed by this feature.

[id="bgp-routing-custom-resources_{context}"]
== BGP routing custom resources

The following custom resources are used to configure BGP routing:

`RouteAdvertisements`::
This custom resource defines the advertisements for the BGP routing. From this CR the OVN-Kubernetes controller generates a `FRRConfiguration` object that configures the FRR daemon to advertise the routes. This CR is cluster scoped.

`FRRConfiguration`::
This custom resource defines the FRR configuration for the BGP routing. This CR is namespaced.

== BGP implementation

TBD
