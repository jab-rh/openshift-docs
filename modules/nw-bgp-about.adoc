// Module included in the following assemblies:
//
// * networking/bgp-routing/about-bgp-routing.adoc

:_mod-docs-content-type: CONCEPT
[id="nw-bgp-about_{context}"]
= Advanced routing with BGP

With advanced routing capabilities enabled, the OVN-Kubernetes network plugin supports the following features:

- Importing routes from the infrastructure network
- Exporting routes into the infrastructure network
- Improving throughput and reducing packet overhead
- Supporting multi-homing, link redundancy, and fast convergence

For example, with advanced routing, routes are dynamically discovered. This eliminates the need to manually configure routes on each node with like NM State. Routing for user-defined networks can be announced to the infrastructure network, avoiding manual configuration steps.

[id="supported-platforms_{context}"]
== Supported platforms

Advanced routing is supported on only bare-metal infrastructure.

[id="prerequisites_{context}"]
== Prerequisites

Use of advanced routing features requires that you have properly configured BGP for your network infrastructure. Outages or misconfigurations of your network infrastructure might cause disruptions to your cluster network.

[id="cluster-network-operator_{context}"]
== Cluster Network Operator configuration

The Cluster Network Operator API exposes several fields to configure advanced routing:

- `spec.additionalRoutingCapabilities`: Enables deployment of the FRR-K8S daemon for the cluster, which can be used independently of route advertisements, such as for the MetalLB Operator. When enabled, the FRR-K8S daemon is deployed on all nodes.
- `spec.defaultNetwork.ovnKubernetesConfig.routeAdvertisements`: Enables route advertisements for the default cluster network and user-defined networks. Additional routing capabilities must be enabled to enable route advertisements.

[id="compatibility-with-other-networking-features_{context}"]
== Compatibility with other networking features

Multiple external gateways::
--
When used with multiple external gateways (MEG) as implemented with the `AdminPolicyBasedExternalRoute` CR, there are several potential interactions:

- When BGP discovers routes to next hops, there can overlap with gateways detected by MEG. If BFD is configured with `nextHops.static.bfdEnabled`, overlapping routes are ignored by OVN-Kubernetes. If BFD is configured in FRR, overlapping routes are immediately purged.
- When MEG is configured for a namespace targeted by a `RouteAdvertisements` CR network selector, an external gateway capable of BGP peering may learn of the pod subnet routes automatically.
--

EgressIPs::
Works with EgressIPs. Moreover these IP addresses are advertised with BGP, so egress IP nodes no longer need to be on the same layer 2 network segment.

Services::
Works in concert with the MetalLB Operator to advertise services to the provider network.

Egress service::
Full support.

Egress firewall::
Full support.

Egress QoS::
Full support.

Network policies::
Full support.

Direct pod ingress::
Full support for the default cluster network and user-defined networks.

[id="considerations-for-use-with-the-metallb-operator_{context}"]
== Considerations for use with the MetalLB Operator

The MetalLB Operator is installed as an add-on to the cluster. Because both BGP routing and MetalLB rely on FRR-K8s for BGP support, enabling additional routing capabilities automatically installs FRR-K8s. When installed, the MetalLB Operator uses the FRR-K8s daemon installed by this feature.

[id="bgp-routing-custom-resources_{context}"]
== BGP routing custom resources

The following custom resources are used to configure BGP routing:

`RouteAdvertisements`::
This custom resource defines the advertisements for the BGP routing. From this CR the OVN-Kubernetes controller generates a `FRRConfiguration` object that configures the FRR daemon to advertise the routes. This CR is cluster scoped.

`FRRConfiguration`::
This custom resource defines the FRR configuration for the BGP routing. This CR is namespaced.

== BGP implementation

TBD
