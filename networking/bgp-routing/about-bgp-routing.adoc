:_mod-docs-content-type: ASSEMBLY
[id="about-bgp-routing"]
= About BGP routing
include::_attributes/common-attributes.adoc[]
:context: about-bgp-routing

toc::[]

This feature provides native BGP routing capabilities for the OVN-Kubernetes network plugin.

**Summary of Use Cases for BGP Integration with OVN-Kubernetes**

Integrating BGP into OVN-Kubernetes addresses several key requirements to enhance network functionality and performance within OpenShift clusters:

1. **Importing Routes from the Provider Network**: Currently, users must manually configure routes on each node using local gateway mode and tools like NM State, which is cumbersome and not dynamic. BGP integration allows OVN-Kubernetes to import routes directly from the provider network, eliminating manual configurations and enabling dynamic routing updates in response to network changes.

2. **Exporting Routes into the Provider Network**: While MetalLB advertises load balancer IPs via BGP, there's a need to advertise pod IPs directly to the provider network for better integration with third-party load balancers. BGP integration enables OVN-Kubernetes to export pod subnets or addresses, allowing external devices to reach pods directly without relying on custom operators to manage routing.

3. **Datapath Performance Enhancement**: By leveraging the underlay network through BGP, tunnel encapsulation can be bypassed, reducing packet overhead and increasing throughput. This direct use of the underlay network enhances performance for applications requiring high bandwidth.

4. **Multi-homing, Link Redundancy, and Fast Convergence**: BGP supports multi-homing with Equal-Cost Multi-Path (ECMP) routing, providing layer 3 failover capabilities. Coupled with Bidirectional Forwarding Detection (BFD), BGP can detect link failures within milliseconds, allowing rapid rerouting of traffic. This is crucial in topologies where nodes have multiple NICs connected to different BGP routers, ensuring high availability and network resilience.

[id="prerequisites_{context}"]
== Prerequisites

Use of advanced routing features requires that you have properly configured BGP for your network infrastructure. Outages or misconfigurations of your network infrastructure might cause disruptions to your cluster network.

== Compatibility with other networking features

Multiple external gateways::
--
When used with multiple external gateways (MEG) as implemented with the `AdminPolicyBasedExternalRoute` CR, there are several potential interactions:

- When BGP discovers routes to next hops, there can overlap with gateways detected by MEG. If BFD is configured with `nextHops.static.bfdEnabled`, overlapping routes are ignored by OVN-Kubernetes. If BFD is configured in FRR, overlapping routes are immediately purged.
- When MEG is configured for a namespace targeted by a `RouteAdvertisements` CR network selector, an external gateway capable of BGP peering may learn of the pod subnet routes automatically.
--

EgressIPs::
Works with EgressIPs. Moreover these IP addresses are advertised with BGP, so egress IP nodes no longer need to be on the same layer 2 network segment.

Services::
Works in concert with the MetalLB Operator to advertise services to the provider network.

Egress service::
Full support.

Egress firewall::
Full support.

Egress QoS::
Full support.

Network policies::
Full support.

Direct pod ingress::


== Considerations for use with the MetalLB Operator

The MetalLB Operator is installed as an add-on to the cluster. Because both BGP routing and MetalLB rely on FRR-K8s for BGP support, enabling additional routing capabilities automatically installs FRR-K8s. When installed, the MetalLB Operator uses the FRR-K8s daemon installed by this feature.

== BGP routing custom resources

The following cluster scoped custom resources are used to configure BGP routing:

`RouteAdvertisements`::
This custom resource defines the advertisements for the BGP routing. From this CR the OVN-Kubernetes controller generates a `FRRConfiguration` object that configures the FRR daemon to advertise the routes.

`FRRConfiguration`::
This custom resource defines the FRR configuration for the BGP routing.

== BGP implementation

TBD

[id="nw-bgp-routing-routeadvertisements-object_{context}"]
=== RouteAdvertisements configuration object

The fields for the `RouteAdvertisements` custom resource are described in the following table:

.`RouteAdvertisements` object
[cols=".^2,.^2,.^6",options="header"]
|====
|Field|Type|Description

|`advertisements.egressIP`
|`boolean`
|Specifies whether the network EgressIPs are advertised.

|`advertisements.podNetwork`
|`boolean`
|Specifies whether the pod network routes are advertised.

|`frrConfigurationSelector`
|`object`
|Optional: Determines which FRRConfigurations the OVN-Kubernetes driven FRRConfigurations will be based on. When omitted, all FRRConfigurations will be considered.

|`networkSelector`
|`object`
|Optional: Specifies which network routes to advertise. When omitted, advertises the default cluster network routes. Only a single network may be selected by a `RouteAdvertisements` CR. If multiple CRs select the same network, OVN-Kubernetes logs an error to the CR status and the configuration is not applied.

|`nodeSelector`
|`object`
|Optional: Limits the advertisements to selected nodes. When omitted, selects all nodes.

|`targetVRF`
|`string`
|Determines which virtual routing and forwarding (VRF) target to advertise the routes in.

|====

== BGP example

In the following example, a node with two pods associated with a user-defined network.

[role="_additional-resources"]
[id="additional-resources_about-bgp-routing"]
== Additional resources

- link:https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/assembly_starting-a-service-within-an-isolated-vrf-network_configuring-and-managing-networking[Starting a service within an isolated VRF network]

